doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title= title
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css")
    // 圖示（打勾、還原）
    link(rel="stylesheet", href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css")
  body
    // 上方訊息（沿用你的 partial）
    include ../partials/message

    // 簡潔導覽列
    nav.navbar.navbar-expand-md.bg-body.border-bottom
      .container
        a.navbar-brand(href="/tasks/home") Group Todos
        #mainNav.collapse.navbar-collapse
        ul.navbar-nav.ms-auto
          li.nav-item
            a.nav-link(href=`/tasks/${id}/edit`) Edit

    // 內容
    main.container.py-4
      .row.align-items-center.mb-3
        .col
          // 計算顏色：priority 用數字、status 用字串
          -
            const prioColorMap = { 1: 'danger', 2: 'warning', 3: 'primary', 4: 'secondary' };
            const statusColorMap = { 'UNFINISHED': 'warning', 'FINISHED': 'success', 'ARCHIVED': 'secondary' };
            const priorityClass = `text-bg-${prioColorMap[priority] || 'secondary'}`;
            const statusClass = `text-bg-${statusColorMap[status] || 'secondary'}`;

          h1.h3.mb-1= title
          .d-flex.flex-wrap.gap-2.mt-2
            span.badge(class=priorityClass) Priority: #{priorityLabel}
            span.badge(class=statusClass) Status: #{statusLabel}
        .col-auto
          // 動作區：Done / Restore + Edit
          .d-flex.gap-2
            if status !== 'FINISHED'
              form(action=`/api/tasks/${id}/update/status`, method="POST")
                input(type="hidden", name="status", value="FINISHED")
                button.btn.btn-success(type="submit" title="Mark as finished")
                  i.bi.bi-check2-circle.me-1
                  | Done
            else
              form(action=`/api/tasks/${id}/update/status`, method="POST")
                input(type="hidden", name="status", value="UNFINISHED")
                button.btn.btn-outline-secondary(type="submit" title="Restore")
                  i.bi.bi-arrow-counterclockwise.me-1
                  | Restore

            a.btn.btn-primary(href=`/tasks/${id}/edit`) Edit

        .card.shadow-sm
          .card-body
            if description
              p.mb-3= description
            else
              p.text-muted.fst-italic.mb-3 No description.

            ul.list-group.list-group-flush
              li.list-group-item
                strong Due:&nbsp;
                if dueLabel
                  | #{dueLabel} 
                  if allDay
                    span.badge.text-bg-warning.ms-2 All Day
                else
                  span.text-muted Not set
              li.list-group-item
                strong Location:&nbsp;
                if location
                  | #{location}
                else
                  span.text-muted Not set
              li.list-group-item
                strong Created:&nbsp; #{createdLabel}
              li.list-group-item
                strong Updated:&nbsp; #{updatedLabel}

      // 返回連結（可選）
      .mt-3
        a.link-secondary(href="/tasks/home") ← Back to all tasks

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js")
