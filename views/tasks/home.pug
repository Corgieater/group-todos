doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title Tasks
    include ../partials/bootstrap
  body
    include ../partials/_task-card
    // è¨Šæ¯èˆ‡å°è¦½åˆ—
    include ../partials/message
    include ../partials/header

    main.container.py-4
      -
        // Priority é…è‰²ï¼ˆsubtle + é‚Šæ¡†ï¼‰
        const prioBgMap = { 1:'bg-danger-subtle', 2:'bg-warning-subtle', 3:'bg-primary-subtle', 4:'bg-secondary-subtle' };
        const prioBorderMap = { 1:'border-danger', 2:'border-warning', 3:'border-primary', 4:'border-secondary' };
        const cardClassForPrio = (p) => `${prioBgMap[p] || ''} ${prioBorderMap[p] || 'border-secondary'} border-2`;
        const safeLen = (arr) => Array.isArray(arr) ? arr.length : 0;
        const totalTasks = safeLen(expired) + safeLen(today) + safeLen(none);

      // Header
      .row.mb-3
        .col
          h1.h4.mb-1 #{name ? `Hi, ${name}` : 'All Tasks'}
          small.text-muted Your personal tasks
        .col-auto.ms-auto.text-end
          span.badge.bg-primary-subtle.text-primary-emphasis.me-2 #{totalTasks}
          | tasks

      .mb-3
        a.btn.btn-sm.btn-outline-primary(href="/tasks/create")
          i.bi.bi-plus-lg.me-1
          | New Task

      // =============== Expired ===============
      section.mt-2
        .d-flex.align-items-baseline.mb-2.gap-2
          h2.h5.mb-0 Expired
          if safeLen(expired)
            span.badge.text-bg-danger #{expired.length}
        if expired && expired.length
          .row.g-3
            each task in expired
              // ğŸš¨ å‘¼å« Mixin
              +taskCard(task, csrfToken, cardClassForPrio)
        else
          p.text-muted.fst-italic No expired tasks.

      // =============== Today ===============
      section.mt-4
        .d-flex.align-items-baseline.mb-2.gap-2
          h2.h5.mb-0 Today
          if safeLen(today)
            span.badge.text-bg-info #{today.length}
        if today && today.length
          .row.g-3
            each task in today
              // ğŸš¨ å‘¼å« Mixin
              +taskCard(task, csrfToken, cardClassForPrio)
        else
          p.text-muted.fst-italic Nothing scheduled for today.

      // =============== No due date ===============
      section.mt-4
        .d-flex.align-items-baseline.mb-2.gap-2
          h2.h5.mb-0 No due date
          if safeLen(none)
            span.badge.text-bg-secondary #{none.length}
        if none && none.length
          .row.g-3
            each task in none
              // ğŸš¨ å‘¼å« Mixin
              +taskCard(task, csrfToken, cardClassForPrio)
        else
          p.text-muted.fst-italic Nothing without due date.

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js")
include ../partials/notification-toast