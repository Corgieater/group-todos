//- views/tasks/_tasks-list.pug
-
  // å®‰å…¨é˜²å‘† + å°å·¥å…·
  const list = Array.isArray(tasks) ? tasks : [];
  const listStatus= typeof currentStatus === 'string' ? currentStatus : 'FINISHED';
  const isDoneTab = status === 'FINISHED';
  const PRIORITY = { 1: 'Urgent', 2: 'High', 3: 'Medium', 4: 'Low' };
  const P_BADGE = { 1: 'danger', 2: 'warning', 3: 'info', 4: 'secondary' };

  const fmtDate = (s) => {
    if (!s) return null;
    const d = new Date(s);
    if (Number.isNaN(d.getTime())) return null;
    // é¡¯ç¤º yyyy/mm/dd hh:mmï¼ˆè‹¥åªæœ‰æ—¥æœŸå°±åªé¡¯ç¤ºæ—¥æœŸï¼‰
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    const HH = String(d.getHours()).padStart(2,'0');
    const MM = String(d.getMinutes()).padStart(2,'0');
    const hasTime = d.getHours() + d.getMinutes() !== 0;
    return hasTime ? `${yyyy}/${mm}/${dd} ${HH}:${MM}` : `${yyyy}/${mm}/${dd}`;
  };

if !list.length
  .card.shadow-sm
    .card-body.text-center.py-5
      .display-6.mb-2 ğŸ—’ï¸
      p.lead.mb-3= emptyHint || 'No tasks.'
      a.btn.btn-primary(href="/tasks/new") + Create a task
else
  //- ç”¨ list-group å‘ˆç¾
  .card.shadow-sm
    .card-header.bg-body
      .d-flex.justify-content-between.align-items-center
        span.fw-semibold #{list.length} task#{list.length > 1 ? 's' : ''} found
        //- å¯åŠ ä¸Šåˆ†é æˆ–æ’åºæ§åˆ¶å€
        // .btn-group
        //   a.btn.btn-sm.btn-outline-secondary(href="?sort=dueAt") Sort by due
        //   a.btn.btn-sm.btn-outline-secondary(href="?sort=priority") Sort by priority
    ul.list-group.list-group-flush
      each t in list
        -
          const dueText = fmtDate(t.dueAt || t.dueDate || null);
          const p = PRIORITY[String(t.priority)] || 'â€”';
          const pb = P_BADGE[String(t.priority)] || 'secondary';
        li.list-group-item
          .d-flex.gap-3.flex-column.flex-md-row.justify-content-between.align-items-start
            // å·¦å€ï¼šæ¨™é¡Œ + æ¬¡è³‡è¨Š
            .flex-grow-1
              .d-flex.align-items-center.gap-2.mb-1
                if t.status === 'FINISHED' || isDoneTab
                  i.bi.bi-check2-circle.text-success
                else
                  i.bi.bi-circle

                h2.h6.mb-0
                  if t.title
                    | #{t.title}
                  else
                    span.text-muted Untitled

                // å„ªå…ˆåº¦ badge
                if t.priority
                  span.badge.ms-2(class=`text-bg-${pb}`)= p

              // æ¬¡è³‡è¨Šåˆ—ï¼šæœŸé™ / åœ°é»
              .text-muted.small
                if dueText
                  span.me-3
                    i.bi.bi-calendar2-event.me-1
                    | #{dueText}
                if t.location
                  span.me-3
                    i.bi.bi-geo-alt.me-1
                    | #{t.location}

              if t.description
                p.mb-0.mt-2= t.description

            // å³å€ï¼šæ“ä½œ
            .d-flex.flex-wrap.gap-2
              //- å®Œæˆ / é‚„åŸ
              if isDoneTab
                // TODO: NOTE
                // Do we need restore? how? why?
                form(action=`/api/tasks/${t.id}/restore` method="POST")
                  button.btn.btn-outline-secondary.btn-sm(type="submit")
                    i.bi.bi-arrow-counterclockwise.me-1
                    | Restore
              else
                form(action=`/api/tasks/${t.id}/finish` method="POST")
                  button.btn.btn-success.btn-sm(type="submit")
                    i.bi.bi-check2.me-1
                    | Mark done

              //- ç·¨è¼¯
              a.btn.btn-outline-primary.btn-sm(href=`/tasks/${t.id}/edit`)
                i.bi.bi-pencil-square.me-1
                | Edit

              //- åˆªé™¤ï¼ˆè‹¥æœ‰ method-overrideï¼Œå¯ç”¨ _method=DELETEï¼‰
              form(action=`/api/tasks/${t.id}?_method=DELETE` method="POST")
                button.btn.btn-outline-danger.btn-sm(type="submit" onclick="return confirm('Delete this task?');")
                  i.bi.bi-trash3.me-1
                  | Delete
