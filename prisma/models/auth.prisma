enum ActionTokenType {
  RESET_PASSWORD
  GROUP_INVITE
}

model ActionToken {
  id        Int             @id @default(autoincrement())
  type      ActionTokenType
  tokenHash String          @unique
  subjectKey  String @unique

  userId     Int?
  user       User?   @relation("UserActionTokens", fields: [userId], references: [id], onDelete: SetNull)
  email      String?
  groupId    Int?
  group      Group?  @relation(fields: [groupId], references: [id], onDelete: Cascade)
  issuedById Int?
  issuedBy   User?   @relation("IssuedTokens", fields: [issuedById], references: [id], onDelete: SetNull)

  expiresAt  DateTime
  consumedAt DateTime?
  revokedAt  DateTime?
  metadata   Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([type, groupId, email, consumedAt])
  @@index([type, userId, consumedAt])
  @@index([expiresAt, consumedAt])
}
